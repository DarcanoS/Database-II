WITH LatestReadings AS (
    SELECT 
        aqr.station_id,
        aqr.pollutant_type,
        aqr.aqi,
        aqr.datetime,
        ROW_NUMBER() OVER (PARTITION BY aqr.station_id, aqr.pollutant_type 
        ORDER BY aqr.datetime DESC) as rn
    FROM AirQualityReading aqr
    JOIN Station s ON aqr.station_id = s.id
    WHERE s.city = 'Bogota'
)
SELECT 
    pollutant_type,
    AVG(aqi) as avg_aqi,
    MAX(datetime) as last_updated
FROM LatestReadings
WHERE rn = 1
GROUP BY pollutant_type