\section{Monitoring Strategy}

\subsection{Key Monitoring Requirements for the Air Quality Platform}

Given the frequent ingestion schedule of our pipeline (periodic jobs running every 10 minutes) and the read-intensive behavior of users, monitoring focuses primarily on operational health, ingestion performance, and error detection. The following table summarizes the core metrics that must be tracked to guarantee platform stability.

\begin{table}[H]
\centering
\begin{tabularx}{\textwidth}{|X|X|X|}
\hline
\textbf{Metric} & \textbf{Description} & \textbf{Reason for Monitoring} \\
\hline
Execution time per ingestion job & Each ingestion cycle (every 10 minutes) must complete within an acceptable time window. & Detects performance degradation, API delays, or processing bottlenecks. \\
\hline
Ingestion delays & Measures the difference between expected ingestion timestamps and actual processed time. & Identifies late data insertion, network issues, or queue congestion. \\
\hline
API errors (4xx / 5xx) & Tracks client-side and server-side errors from external providers (AQICN, Google, IQAir). & Quickly identifies provider failures, quota exhaustion, or malformed requests. \\
\hline
Log retention (7 days) & All ingestion, processing, and pipeline logs are stored for one week. & Ensures traceability for incident analysis without excessive storage usage. \\
\hline
\end{tabularx}
\caption{Key Monitoring Requirements of the Platform}
\end{table}

\subsection{Monitoring Scenarios Aligned with Current Usage Patterns}

Since current users only perform read operations and there is no multi-user editing, concurrency-related monitoring is minimal. Instead, monitoring focuses on ingestion consistency, system stability, and availability.

\begin{itemize}
    \item \textbf{Ingestion every 10 minutes:} The ingestion pipeline must be monitored to ensure that no job exceeds the allowed duration or becomes desynchronized with the schedule.
    
    \item \textbf{Read-only dashboard usage:} All interactions with dashboards and reports depend on the consistency of recent ingestions. Monitoring query performance ensures users always access fresh and reliable AQI data.
    
    \item \textbf{Single-client configuration:} Because ingestion, reporting, and visualization are centralized, the risk of concurrent modifications is negligible. Monitoring therefore focuses on operational continuity.
\end{itemize}

\subsection{Potential Operational Problems and Examples}

\begin{itemize}
    \item \textbf{Slow Ingestion Job:} If an ingestion cycle takes longer than 10 minutes, subsequent jobs may overlap, causing delays and cascading failures.
    
    \item \textbf{High API Error Rates:} A spike in 4xx errors may indicate quota exhaustion or invalid parameters; 5xx errors may signal temporary outages from external APIs.
    
    \item \textbf{Delayed Data Availability:} If ingestion is delayed, dashboards may show outdated AQI values, reducing reliability of alerts and recommendations.
    
    \item \textbf{Insufficient Log Retention:} If logs rotate too early, incident diagnosis becomes impossible; if they persist too long, storage cost increases unnecessarily.
\end{itemize}

\subsection{Proposed Monitoring Controls and Tools}

\begin{table}[H]
\centering
\begin{tabularx}{\textwidth}{|X|X|X|}
\hline
\textbf{Metric} & \textbf{Control Mechanism} & \textbf{Justification} \\
\hline
Execution time per ingestion job & Track duration via cron monitoring or job instrumentation (Prometheus + Grafana) & Detect anomalies early and prevent overlap between ingestion cycles. \\
\hline
Ingestion delays & Compare expected timestamps vs. actual ingestion completion time & Ensures that dashboards and reports operate on timely and accurate data. \\
\hline
API errors (4xx / 5xx) & Implement error counters and alert thresholds & Enables rapid detection of external provider issues and reduces downtime. \\
\hline
Log retention (7 days) & Configure log rotation policies (e.g., Loki or ELK) & Provides sufficient data for audits while keeping storage usage efficient. \\
\hline
\end{tabularx}
\caption{Monitoring Metrics and Control Mechanisms}
\end{table}

\subsection{Fit with Existing Architecture}

The monitoring strategy fits naturally with the PostgreSQL-based architecture and can leverage additional optimizations as the platform evolves:

\begin{itemize}
    \item \textbf{PostgreSQL with optional partitioning or TimescaleDB:} The platform can adopt time-based partitioning or TimescaleDB extensions in the future to improve query performance and enable more efficient ingestion monitoring as dataset size grows.
    
    \item \textbf{Materialized views for dashboards:} The architecture can utilize materialized views to accelerate dashboard queries; monitoring their refresh times would ensure smooth user experience and prevent stale visualizations.
    
    \item \textbf{Hybrid storage model (PostgreSQL + lightweight NoSQL):} Logs and ingestion traces can be stored efficiently and accessed independently of analytical workloads.
    
    \item \textbf{Containerized ingestion pipeline:} Each component exposes clear metrics and logs, enabling granular monitoring.
    
    \item \textbf{Centralized log retention (7 days):} Ensures consistent access to operational data without overwhelming storage resources.
\end{itemize}
