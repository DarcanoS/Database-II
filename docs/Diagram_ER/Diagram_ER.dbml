//// GEOSPATIAL & MONITORING (Operational)

Table Station {
  id int [pk]
  name varchar
  latitude float
  longitude float
  city varchar
  country varchar
  region_id int [ref: > MapRegion.id]
}

Table AirQualityReading {
  id int [pk]
  station_id int [ref: > Station.id]
  pollutant_id int [ref: > Pollutant.id]
  datetime timestamp
  value float
  aqi int
}

Table Pollutant {
  id int [pk]
  name varchar
  unit varchar
  description text
}

Table MapRegion {
  id int [pk]
  name varchar
  geom geometry // optional: for advanced geospatial visualizations (PostGIS)
}

//// USERS & ACCESS CONTROL (Operational)

Table AppUser {
  id int [pk]
  name varchar
  email varchar
  password_hash varchar
  location varchar
  role_id int [ref: > Role.id]
}

Table Role {
  id int [pk]
  name varchar [unique]
}

Table Permission {
  id int [pk]
  name varchar [unique]
}

Table RolePermission {
  role_id int [ref: > Role.id]
  permission_id int [ref: > Permission.id]
  primary key (role_id, permission_id)
}

//// ALERTS & PERSONALIZATION (Operational)

Table Alert {
  id int [pk]
  user_id int [ref: > AppUser.id]
  pollutant_id int [ref: > Pollutant.id]
  threshold float
  method varchar        // e.g. 'email', 'sms'
  triggered_at timestamp
}

// Generic recommendation to the user based on pollution level,
// e.g. "use a basic mask" or "avoid outdoor exercise".
Table Recommendation {
  id int [pk]
  user_id int [ref: > AppUser.id]
  location varchar       // city or area name
  pollution_level int    // e.g. AQI value used to choose the advice
  message text           // human-readable recommendation
  created_at timestamp
}

// Simple mapping from a recommendation to a suggested protection product,
// for example: normal mask vs specialized mask.
Table ProductRecommendation {
  id int [pk]
  recommendation_id int [ref: > Recommendation.id]
  product_name varchar       // e.g. 'Basic Face Mask'
  product_type varchar       // e.g. 'mask', 'respirator'
  product_url varchar        // optional: informational link
}

//// REPORTING & ANALYTICS

// Operational report metadata (no JSON).
Table Report {
  id int [pk]
  user_id int [ref: > AppUser.id]
  created_at timestamp
  city varchar
  start_date date
  end_date date
  station_id int [ref: > Station.id]
  pollutant_id int [ref: > Pollutant.id]
  file_path varchar
}

// Analytical aggregated data for BI (analytical domain).
Table AirQualityDailyStats {
  id int [pk]
  station_id int [ref: > Station.id]
  pollutant_id int [ref: > Pollutant.id]
  date date
  avg_value float
  avg_aqi int
  max_aqi int
  min_aqi int
  readings_count int
}
